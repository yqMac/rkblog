<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一言以蔽 · 设计模式 | 随手记</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?a46ad829404b742959db51bb648db536";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script>
    <meta name="description" content="努力不一定成功，但放弃一定失败">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.4e17aa0c.css" as="style"><link rel="preload" href="/assets/js/app.6f47cd4a.js" as="script"><link rel="preload" href="/assets/js/5.0858778f.js" as="script"><link rel="preload" href="/assets/js/1.474579b7.js" as="script"><link rel="preload" href="/assets/js/18.f18c6ce8.js" as="script"><link rel="preload" href="/assets/js/11.a67626a0.js" as="script"><link rel="prefetch" href="/assets/js/10.a9e7d25d.js"><link rel="prefetch" href="/assets/js/12.41574601.js"><link rel="prefetch" href="/assets/js/13.6aafce2f.js"><link rel="prefetch" href="/assets/js/14.8bf41eaf.js"><link rel="prefetch" href="/assets/js/15.ef74cc57.js"><link rel="prefetch" href="/assets/js/16.2fc2746a.js"><link rel="prefetch" href="/assets/js/17.44b6285c.js"><link rel="prefetch" href="/assets/js/19.684db896.js"><link rel="prefetch" href="/assets/js/20.7667e3cc.js"><link rel="prefetch" href="/assets/js/21.f2230ac8.js"><link rel="prefetch" href="/assets/js/22.950353dc.js"><link rel="prefetch" href="/assets/js/23.8f5be27a.js"><link rel="prefetch" href="/assets/js/24.cfb481a8.js"><link rel="prefetch" href="/assets/js/25.628dba97.js"><link rel="prefetch" href="/assets/js/26.dcd96fef.js"><link rel="prefetch" href="/assets/js/27.9be13953.js"><link rel="prefetch" href="/assets/js/28.a88d7977.js"><link rel="prefetch" href="/assets/js/29.8ea8e870.js"><link rel="prefetch" href="/assets/js/3.c91ee5c0.js"><link rel="prefetch" href="/assets/js/30.92ac6403.js"><link rel="prefetch" href="/assets/js/31.b0371c16.js"><link rel="prefetch" href="/assets/js/32.69cb07ed.js"><link rel="prefetch" href="/assets/js/33.0b6f145a.js"><link rel="prefetch" href="/assets/js/34.90830276.js"><link rel="prefetch" href="/assets/js/35.59beaf16.js"><link rel="prefetch" href="/assets/js/36.749217dd.js"><link rel="prefetch" href="/assets/js/37.e582c13e.js"><link rel="prefetch" href="/assets/js/38.efa50a60.js"><link rel="prefetch" href="/assets/js/39.d315abb1.js"><link rel="prefetch" href="/assets/js/4.4751b992.js"><link rel="prefetch" href="/assets/js/40.772b3dee.js"><link rel="prefetch" href="/assets/js/41.7549e2db.js"><link rel="prefetch" href="/assets/js/42.c75ad522.js"><link rel="prefetch" href="/assets/js/43.54cdad85.js"><link rel="prefetch" href="/assets/js/6.ce4d556b.js"><link rel="prefetch" href="/assets/js/7.be494330.js"><link rel="prefetch" href="/assets/js/8.62fbb1d7.js"><link rel="prefetch" href="/assets/js/9.13c7c92e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4e17aa0c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-bb35d904><div data-v-bb35d904><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-bb35d904 data-v-bb35d904><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-ccaca6de data-v-bb35d904 data-v-bb35d904><h3 class="title" style="display:none;" data-v-ccaca6de data-v-ccaca6de>随手记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-ccaca6de data-v-ccaca6de><input type="password" value="" data-v-ccaca6de> <span data-v-ccaca6de>Konck! Knock!</span> <button data-v-ccaca6de>确认</button></label> <div class="footer" style="display:none;" data-v-ccaca6de data-v-ccaca6de><span data-v-ccaca6de><i class="iconfont reco-theme" data-v-ccaca6de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-ccaca6de>vuePress-theme-reco</a></span> <span data-v-ccaca6de><i class="iconfont reco-copyright" data-v-ccaca6de></i> <a data-v-ccaca6de><span data-v-ccaca6de>Rookie</span>
            
          <span data-v-ccaca6de>2017 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-bb35d904><div data-v-bb35d904><div id="smart" class="wrapper-page" style="background-image:url(https://zyj_yida.gitee.io/source/img/indexbg/36.jpg);background-position-x:center;background-position-y:center;background-size:cover;background-repeat-x:no-repeat;background-repeat-y:no-repeat;" data-v-bb35d904><header class="navbar" style="position:relative;background:none rgba(0, 0, 0, 0.2);box-shadow:none;" data-v-bb35d904><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img ÅÅ="" src="https://tva1.sinaimg.cn/large/e6c9d24ely1go6gkxv8keg2050050mx9.gif" alt="随手记" class="logo"> <span class="site-name">随手记</span></a> <div class="links"><div id="dayNightSwitch" class="generalWrapper" data-v-32f44868><a class="click" data-v-32f44868><div class="onOff daySwitch" data-v-32f44868><div class="star star1" data-v-32f44868></div> <div class="star star2" data-v-32f44868></div> <div class="star star3" data-v-32f44868></div> <div class="star star4" data-v-32f44868></div> <div class="star star5" data-v-32f44868></div> <div class="star sky" data-v-32f44868></div> <div class="sunMoon" data-v-32f44868><div class="crater crater1" data-v-32f44868></div> <div class="crater crater2" data-v-32f44868></div> <div class="crater crater3" data-v-32f44868></div> <div class="cloud part1" data-v-32f44868></div> <div class="cloud part2" data-v-32f44868></div></div></div></a></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/博客搭建/" class="nav-link"><i class="iconfont undefined"></i>
  博客搭建
</a></li><li class="dropdown-item"><!----> <a href="/categories/运维/" class="nav-link"><i class="iconfont undefined"></i>
  运维
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="https://manage.yqmac.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  简历
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-bb35d904></div> <aside class="sidebar" data-v-bb35d904><div class="personal-info-wrapper" data-v-03833281 data-v-bb35d904><img src="https://tva1.sinaimg.cn/large/e6c9d24ely1go6gkxv8keg2050050mx9.gif" alt="author-avatar" class="personal-img" data-v-03833281> <h3 class="name" data-v-03833281>
    Rookie
  </h3> <div class="num" data-v-03833281><div data-v-03833281><h3 data-v-03833281>30</h3> <h6 data-v-03833281>文章</h6></div> <div data-v-03833281><h3 data-v-03833281>19</h3> <h6 data-v-03833281>标签</h6></div></div> <hr data-v-03833281></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      博客
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/后端/" class="nav-link"><i class="iconfont undefined"></i>
  后端
</a></li><li class="dropdown-item"><!----> <a href="/categories/随笔/" class="nav-link"><i class="iconfont undefined"></i>
  随笔
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/博客搭建/" class="nav-link"><i class="iconfont undefined"></i>
  博客搭建
</a></li><li class="dropdown-item"><!----> <a href="/categories/运维/" class="nav-link"><i class="iconfont undefined"></i>
  运维
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="https://manage.yqmac.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-coding"></i>
  简历
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-ccaca6de data-v-bb35d904><h3 class="title" style="display:none;" data-v-ccaca6de data-v-ccaca6de>一言以蔽 · 设计模式</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-ccaca6de data-v-ccaca6de><input type="password" value="" data-v-ccaca6de> <span data-v-ccaca6de>Konck! Knock!</span> <button data-v-ccaca6de>确认</button></label> <div class="footer" style="display:none;" data-v-ccaca6de data-v-ccaca6de><span data-v-ccaca6de><i class="iconfont reco-theme" data-v-ccaca6de></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-ccaca6de>vuePress-theme-reco</a></span> <span data-v-ccaca6de><i class="iconfont reco-copyright" data-v-ccaca6de></i> <a data-v-ccaca6de><span data-v-ccaca6de>Rookie</span>
            
          <span data-v-ccaca6de>2017 - </span>
          2021
        </a></span></div></div></div> <div data-v-bb35d904><main class="page" style="padding-right:0;"><div class="page-title" style="display:none;"><h1 class="title">一言以蔽 · 设计模式</h1> <div class="page-info" data-v-0efa1f05><i class="iconfont reco-account" data-v-0efa1f05><span data-v-0efa1f05>Rookie</span></i> <i class="iconfont reco-date" data-v-0efa1f05><span data-v-0efa1f05>2020-04-16 01:14:45</span></i> <i class="iconfont reco-eye" data-v-0efa1f05><span id="/blogs/docs/back-end/java/designing-pattern/DesigningPattern.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-0efa1f05><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-0efa1f05><span class="tag-item" data-v-0efa1f05>Java</span><span class="tag-item" data-v-0efa1f05>基础</span><span class="tag-item" data-v-0efa1f05>设计模式</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block tip"><p>想了西游记中的场景用来举例，百度一搜已经有人捷足先登了<br>
果然我能想到的别人早就想到了<br> <code>_(:з」∠)_</code></p></div> <h2 id="设计原则"><a href="#设计原则" class="header-anchor">#</a> 设计原则 <span class="badge warning" style="vertical-align:top;" data-v-01e68abf>了解</span></h2> <h3 id="开闭原则"><a href="#开闭原则" class="header-anchor">#</a> 开闭原则</h3> <p>开闭原则(Open-Closed Principle, OCP)是指一个软件实体如类、模块和函数应该<code>对扩展开放，对修改关闭</code>。
所谓的开闭，也正是对扩展和修改两个行为的一个原则。强调 的是用抽象构建框架，用实现扩展细节。
可以提高软件系统的可复用性及可维护性。开闭原则，是面向对象设计中最基础的设计原则。它指导我们如何建立稳定灵活的系统，
例如:我们版本更新，我尽可能不修改源代码，但是可以增加新功能。 在现实生活中对于开闭原则也有体现。
比如，很多互联网公司都实行弹性制作息时间， 规定每天工作8 小时。意思就是说，对于每天工作 8 小时这个规定是关闭的，
但是你什么时候来，什么时候走是开放的。早来早走，晚来晚走。</p> <h3 id="依赖倒置原则"><a href="#依赖倒置原则" class="header-anchor">#</a> 依赖倒置原则</h3> <p>依赖倒置原则(Dependence Inversion Principle,DIP)是指设计代码结构时，高层模块不应该依赖底层模块，
二者都应该依赖其抽象。抽象不应该依赖细节;细节应该依赖 抽象。通过依赖倒置，可以减少类与类之间的耦合性，
提高系统的稳定性，提高代码的可读性和可维护性，并能够降低修改程序所造成的风险。</p> <h3 id="单一职责原则"><a href="#单一职责原则" class="header-anchor">#</a> 单一职责原则</h3> <p>单一职责(Simple Responsibility Pinciple，SRP)是指不要存在多于一个导致类变更的原因。假设我们有一个 Class负责两个职责，一旦发生需求变更，修改其中一个职责的
逻辑代码，有可能会导致另一个职责的功能发生故障。这样一来，这个 Class 存在两个导致类变更的原因。如何解决这个问题呢?我们就要给两个职责分别用两个 Class 来实现，
进行解耦。后期需求变更维护互不影响。这样的设计，可以降低类的复杂度，提高类的可读性，提高系统的可维护性，降低变更引起的风险。</p> <h3 id="接口隔离原则"><a href="#接口隔离原则" class="header-anchor">#</a> 接口隔离原则</h3> <p>接口隔离原则(Interface Segregation Principle, ISP)是指用多个专门的接口，而不使用单一的总接口，客户端不应该依赖它不需要的接口。
这个原则指导我们在设计接口时 应当注意一下几点:<br>
1、一个类对一类的依赖应该建立在最小的接口之上。<br>
2、建立单一接口，不要建立庞大臃肿的接口。<br>
3、尽量细化接口，接口中的方法尽量少(不是越少越好，一定要适度)。<br>
接口隔离原则符合我们常说的高内聚低耦合的设计思想，从而使得类具有很好的可读性、 可扩展性和可维护性。我们在设计接口的时候，要多花时间去思考，要考虑业务模型，</p> <h3 id="迪米特法则"><a href="#迪米特法则" class="header-anchor">#</a> 迪米特法则</h3> <p>迪米特原则(Law of Demeter LoD)是指一个对象应该对其他对象保持最少的了解，又叫最少知道原则(Least Knowledge Principle,LKP)，
尽量降低类与类之间的耦合。迪米特原则主要强调只和朋友交流，不和陌生人说话。出现在成员变量、方法的输入、输出参数中的类都可以称之为成员朋友类，
而出现在方法体内部的类不属于朋友类。</p> <h3 id="里氏替换原则"><a href="#里氏替换原则" class="header-anchor">#</a> 里氏替换原则</h3> <p>里氏替换原则(Liskov Substitution Principle,LSP)是指如果对每一个类型为 T1 的对 象 o1,都有类型为 T2 的对象 o2,
使得以 T1 定义的所有程序 P 在所有的对象 o1 都替换成 o2 时，程序 P 的行为没有发生变化，那么类型 T2 是类型 T1 的子类型。
定义看上去还是比较抽象，我们重新理解一下，可以理解为一个软件实体如果适用一个 父类的话，那一定是适用于其子类，所有引用父
类的地方必须能透明地使用其子类的对 象，子类对象能够替换父类对象，而程序逻辑不变。根据这个理解，我们总结一下:<br>
引申含义:子类可以扩展父类的功能，但不能改变父类原有的功能。<br>
1、子类可以实现父类的抽象方法，但不能覆盖父类的非抽象方法。<br>
2、子类中可以增加自己特有的方法。<br>
3、当子类的方法重载父类的方法时，方法的前置条件(即方法的输入/入参)要比父类 方法的输入参数更宽松。<br>
4、当子类的方法实现父类的方法时(重写/重载或实现抽象方法)，方法的后置条件(即 方法的输出/返回值)要比父类更严格或相等。<br>
使用里氏替换原则有以下优点:<br>
1、约束继承泛滥，开闭原则的一种体现。<br>
2、加强程序的健壮性，同时变更时也可以做到非常好的兼容性，提高程序的维护性、扩 展性。降低需求变更时引入的风险。</p> <h3 id="合成复用原则"><a href="#合成复用原则" class="header-anchor">#</a> 合成复用原则</h3> <p>合成复用原则(Composite/Aggregate Reuse Principle,CARP)是指尽量使用对象组合(has-a)/聚合(contanis-a)，
而不是继承关系达到软件复用的目的。可以使系统更加灵 活，降低类与类之间的耦合度，
一个类的变化对其他类造成的影响相对较少。 继承我们叫做白箱复用，相当于把所有的实现细节暴露给子类。
组合/聚合也称之为黑箱 复用，对类以外的对象是无法获取到实现细节的。要根据具体的业务场景来做代码设计，
其实也都需要遵循 OOP 模型。</p> <h2 id="工厂模式"><a href="#工厂模式" class="header-anchor">#</a> 工厂模式 <span class="badge tip" style="vertical-align:top;" data-v-01e68abf>重点</span> <span class="badge warning" style="vertical-align:top;" data-v-01e68abf>创建型</span></h2> <p>工厂模式分为简单工厂模式，工厂方法模式和抽象工厂模式，它们都属于设计模式中的创建型模式。其主要功能都是帮助我们把对象的实例化部分抽取了出来，目的是降低系统中代码耦合度，并且增强了系统的扩展性。</p> <h3 id="简单工厂模式"><a href="#简单工厂模式" class="header-anchor">#</a> 简单工厂模式</h3> <p>又称为静态工厂方法(Static Factory Method)模式，它属于类创建型模式。在简单工厂模式中，可以根据参数的不同返回不同类的实例。简单工厂模式专门定义一个类来负责创建其他类的实例，被创建的实例通常都具有共同的父类。</p> <div class="custom-block warning"><p class="custom-block-title">提示</p> <p>简单工厂模式不属于23种GOF中的设计模式。</p></div> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <div class="custom-block tip"><p>以《西游记》中师傅总被妖怪抓走了举例</p></div> <p>新建接口<code>IMonster</code>，妖怪都想吃唐僧肉，定义一个<code>eatTangSeng</code>方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @InterfaceName IMonster
 * @Description 妖怪接口，他们都想吃唐僧肉
 * @Author hou
 * @Date 2020/4/19 10:04 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMonster</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建两个妖怪类：<code>BaiGuJing</code> <code>DaPengNiao</code> 它们都实现了<code>IMonster</code>接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName BaiGuJing
 * @Description 白骨精
 * @Author hou
 * @Date 2020/4/19 10:08 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaiGuJing</span> <span class="token keyword">implements</span> <span class="token class-name">IMonster</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是白骨精，我要吃唐僧肉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName DaPengNiao
 * @Description 大鹏鸟
 * @Author hou
 * @Date 2020/4/19 10:12 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DaPengNiao</span> <span class="token keyword">implements</span> <span class="token class-name">IMonster</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是大鹏鸟，我要吃唐僧肉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建工厂，含有一个<code>create</code>方法，只要传递妖怪的名字，工厂就会创造一个妖怪实例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName MonsterFactory
 * @Description 妖怪工厂
 * @Author hou
 * @Date 2020/4/19 10:01 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterFactory</span> <span class="token punctuation">{</span>

    <span class="token class-name">IMonster</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> monsterName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;baigujing&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>monsterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BaiGuJing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;dapengniao&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>monsterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DaPengNiao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>编写测试类，分别测试<code>BaiGuJing</code> <code>DaPengNiao</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token class-name">Factory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory<span class="token punctuation">.</span></span><span class="token class-name">IMonster</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory<span class="token punctuation">.</span></span><span class="token class-name">MonsterFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName TestSimpleFactory
 * @Description TODO
 * @Author hou
 * @Date 2020/4/19 10:21 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSimpleFactory</span> <span class="token punctuation">{</span>

    <span class="token class-name">MonsterFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MonsterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 测试白骨精
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testBaiGuJing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">IMonster</span> baigujing <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;baigujing&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        baigujing<span class="token punctuation">.</span><span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token comment">/**
     * 测试大鹏鸟
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDaPengNiao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">IMonster</span> dapengniao <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;dapengniao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dapengniao<span class="token punctuation">.</span><span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>执行结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdzfz3pcshj31c00u015f.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdzfzpefe1j31c00u0alw.jpg" alt=""></p> <p>假设此时，一个名叫<code>红孩儿</code>的妖怪也要吃唐僧肉，需要几步呢？<br>
新建<code>HongHaiEr</code>类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName HongHaiEr
 * @Description 红孩儿
 * @Author hou
 * @Date 2020/4/19 10:33 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HongHaiEr</span> <span class="token keyword">implements</span> <span class="token class-name">IMonster</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是红孩儿，我要吃唐僧肉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在工厂中&quot;注册&quot;</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>simple_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName MonsterFactory
 * @Description 妖怪工厂
 * @Author hou
 * @Date 2020/4/19 10:01 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">IMonster</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> monsterName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;baigujing&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>monsterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BaiGuJing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;dapengniao&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>monsterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DaPengNiao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;honghaier&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>monsterName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HongHaiEr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>编写测试类，运行结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdzgc9kfwej31c00u0am0.jpg" alt=""></p> <p>类图如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdzgk8ydjmj313i0jwabd.jpg" alt=""></p> <h4 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h4> <p>只需要传入一个正确的参数，就可以获取所需的对象，无须知道其创建的细节。</p> <h4 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h4> <p>工厂类的职责相对过重，一旦有&quot;产品&quot;的增加或删除，整个工厂都要受到影响，违反了<code>开闭原则</code>，代码耦合度较高</p> <h4 id="实际应用"><a href="#实际应用" class="header-anchor">#</a> 实际应用</h4> <p>Calendar中通过不同的时区获得不同的对象
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gdzhk6r1jfj31c00u0h0g.jpg" alt=""></p> <p>Log4j通过类名字或者Class获取Logger
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdzhpexm7vj31c00u04dd.jpg" alt=""></p> <h3 id="工厂方法模式"><a href="#工厂方法模式" class="header-anchor">#</a> 工厂方法模式</h3> <p>通过定义工厂父类负责定义创建对象的公共接口，而子类则负责生成具体的对象。将类的实例化（具体产品的创建）延迟到工厂类的子类（具体工厂）中完成，即由子类来决定应该实例化（创建）哪一个类。</p> <h4 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h4> <div class="custom-block tip"><p>以《西游记》中有后台的妖怪举例</p></div> <p>定义<code>妖怪</code>接口，还是想吃唐僧</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName IMonster
 * @Description 妖怪接口
 * @Author hou
 * @Date 2020/4/19 11:43 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMonster</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义顶级工厂类，含有创建妖怪的抽象方法。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName MonsterFactory
 * @Description 顶级工厂类
 * @Author hou
 * @Date 2020/4/19 11:38 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">MonsterFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span>  <span class="token class-name">IMonster</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将妖怪按照后台划分为<code>佛教</code> <code>道家</code> 两种，分别创建具体工厂</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName BuddhismFactory
 * @Description 后台为&quot;佛教&quot;的工厂
 * @Author hou
 * @Date 2020/4/19 11:47 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BuddhismFactory</span> <span class="token keyword">extends</span> <span class="token class-name">MonsterFactory</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IMonster</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Buddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName TaoistFactory
 * @Description 后台为&quot;道家&quot;的工厂
 * @Author hou
 * @Date 2020/4/19 11:47 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaoistFactory</span> <span class="token keyword">extends</span> <span class="token class-name">MonsterFactory</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IMonster</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Taoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建两个对象实例</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Buddhism
 * @Description TODO
 * @Author hou
 * @Date 2020/4/20 12:31 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Buddhism</span> <span class="token keyword">implements</span> <span class="token class-name">IMonster</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是佛教中人，我是佛祖的亲戚金翅大鹏鸟。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是佛教中人，我是文殊菩萨的坐骑青毛狮子。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是佛教中人，我是普贤菩萨的坐骑六牙白象。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我们要吃唐僧肉。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Taoist
 * @Description TODO
 * @Author hou
 * @Date 2020/4/20 12:34 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Taoist</span> <span class="token keyword">implements</span> <span class="token class-name">IMonster</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是道家中人，我是金角大王，太上老君门下看守金炉的童子。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是道家中人，我是银角大王，太上老君门下看守银炉的童子。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我们要吃唐僧肉。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>编写测试类，运行结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdzjyrhn7uj31c00u0gzj.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdzjzpfrl4j31c00u0qg6.jpg" alt=""></p> <p>新增无后台的&quot;野生&quot;妖怪工厂</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName WildFactory
 * @Description 野生工厂
 * @Author hou
 * @Date 2020/4/20 12:45 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WildFactory</span> <span class="token keyword">extends</span> <span class="token class-name">MonsterFactory</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IMonster</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Wild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>添加实例对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Wild
 * @Description 野生实例
 * @Author hou
 * @Date 2020/4/20 12:45 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Wild</span> <span class="token keyword">implements</span> <span class="token class-name">IMonster</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是没有后台的白骨精，我想吃唐僧肉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdzk4v09rqj31c00u014x.jpg" alt=""></p> <h4 id="优点-2"><a href="#优点-2" class="header-anchor">#</a> 优点</h4> <p>新增&quot;产品&quot;符合了&quot;开闭原则&quot;，提高了系统的可扩展性</p> <h4 id="缺点-2"><a href="#缺点-2" class="header-anchor">#</a> 缺点</h4> <p>类的个数容易过多，增加了代码结构的复杂性；增加了系统的抽象性和理解难度</p> <h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="header-anchor">#</a> 抽象工厂模式</h3> <p>提供一个创建一系列相关或者互相依赖对象的接口，无需指定他们的具体类</p> <h4 id="实例"><a href="#实例" class="header-anchor">#</a> 实例</h4> <p>创建后台为<code>佛教</code> <code>道家</code>的实例接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName IBuddhism
 * @Description 佛教后台的妖怪接口
 * @Author hou
 * @Date 2020/4/20 12:59 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IBuddhism</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName ITaoist
 * @Description 道家后台的妖怪接口
 * @Author hou
 * @Date 2020/4/20 12:59 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ITaoist</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建后台为<code>佛教</code> <code>道家</code>的实例对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">factory<span class="token punctuation">.</span>factory_method<span class="token punctuation">.</span></span><span class="token class-name">IMonster</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Buddhism
 * @Description TODO
 * @Author hou
 * @Date 2020/4/20 12:31 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Buddhism</span> <span class="token keyword">implements</span> <span class="token class-name">IBuddhism</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是佛教中人，我是佛祖的亲戚金翅大鹏鸟。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是佛教中人，我是文殊菩萨的坐骑青毛狮子。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是佛教中人，我是普贤菩萨的坐骑六牙白象。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我们要吃唐僧肉。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Taoist
 * @Description TODO
 * @Author hou
 * @Date 2020/4/20 12:34 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Taoist</span> <span class="token keyword">implements</span> <span class="token class-name">ITaoist</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是道家中人，我是金角大王，太上老君门下看守金炉的童子。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我的后台是道家中人，我是银角大王，太上老君门下看守银炉的童子。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我们要吃唐僧肉。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>声明一个工厂接口可以生成两种对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @InterfaceName IMonsterFactory
 * @Description 妖怪工厂接口
 * @Author hou
 * @Date 2020/4/20 1:03 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMonsterFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">IBuddhism</span> <span class="token function">createBuddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ITaoist</span> <span class="token function">createTaoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>声明一个工厂，实现工厂接口，并重写相应的方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName MonsterFactory
 * @Description 妖怪工厂
 * @Author hou
 * @Date 2020/4/20 1:03 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IMonsterFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IBuddhism</span> <span class="token function">createBuddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Buddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ITaoist</span> <span class="token function">createTaoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Taoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdzky3vecij31c00u0nbp.jpg" alt=""></p> <p>新增无后台的&quot;野生&quot;妖怪实例接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName IWild
 * @Description 无后台的野生妖怪接口
 * @Author hou
 * @Date 2020/4/20 12:59 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IWild</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>添加实例对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Wild
 * @Description 野生妖怪
 * @Author hou
 * @Date 2020/4/20 12:31 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Wild</span> <span class="token keyword">implements</span> <span class="token class-name">IWild</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eatTangSeng</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;我是没有后台的白骨精，我想吃唐僧肉&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在工厂中添加生成新产品的方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @InterfaceName IMonsterFactory
 * @Description 妖怪工厂接口
 * @Author hou
 * @Date 2020/4/20 1:03 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IMonsterFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">IBuddhism</span> <span class="token function">createBuddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">ITaoist</span> <span class="token function">createTaoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">IWild</span> <span class="token function">createWild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">factory<span class="token punctuation">.</span>abstract_factory</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName MonsterFactory
 * @Description 妖怪工厂
 * @Author hou
 * @Date 2020/4/20 1:03 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonsterFactory</span> <span class="token keyword">implements</span> <span class="token class-name">IMonsterFactory</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IBuddhism</span> <span class="token function">createBuddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Buddhism</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ITaoist</span> <span class="token function">createTaoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Taoist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">IWild</span> <span class="token function">createWild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Wild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gdzl2iienfj31c00u0duz.jpg" alt=""></p> <h4 id="优点-3"><a href="#优点-3" class="header-anchor">#</a> 优点</h4> <p>具体产品在应用层代码隔离，无须关心创建细节
将一个系列的产品族统一到一起创建</p> <h4 id="缺点-3"><a href="#缺点-3" class="header-anchor">#</a> 缺点</h4> <p>规定了所有可能被创建的产品集合，产品族中扩展新的产品困难，需要修改抽象工厂的接口
增加了系统的抽象性和理解难度</p> <div class="custom-block warning"><p class="custom-block-title">说明</p> <p>虽然抽象工厂模式比工厂方法模式少创建了&quot;子工厂&quot;，同样也存在扩展性的问题。<br>
抽象工厂模式也不符合&quot;开闭原则&quot;</p></div> <h2 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式 <span class="badge tip" style="vertical-align:top;" data-v-01e68abf>重点</span> <span class="badge warning" style="vertical-align:top;" data-v-01e68abf>创建型</span></h2> <div class="custom-block tip"><p>我就是我，是颜色不一样的烟火            ---《我》</p></div> <p>单例模式是指确保一个类在任何情况下都绝对只有一个实例，并提供一个全局的访问点。</p> <p>以《西游记》中自始至终都只有一个孙悟空为例（分身不算）</p> <h3 id="饿汉式单例"><a href="#饿汉式单例" class="header-anchor">#</a> 饿汉式单例</h3> <p>在单例首次加载时创建单例，无论会不会使用到这个实例都会进行创建。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>hungry_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName HungrySingleton
 * @Description 饿汉式单例
 * @Author hou
 * @Date 2020/4/20 12:49 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HungrySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 构造方法私有化</span>
    <span class="token keyword">private</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0c5eqxfej31c00u018t.jpg" alt=""></p> <h4 id="优点-4"><a href="#优点-4" class="header-anchor">#</a> 优点</h4> <p>只创建(new)了一次，不存在线程问题</p> <h4 id="缺点-4"><a href="#缺点-4" class="header-anchor">#</a> 缺点</h4> <p>无论会不会对此对象进行使用，都会进行创建，浪费内存</p> <h3 id="懒汉式单例"><a href="#懒汉式单例" class="header-anchor">#</a> 懒汉式单例</h3> <p>对<code>饿汉式单例</code>的优化，在单例对象被调用时，创建对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>lazy_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName LazySingleton
 * @Description 懒汉式单例
 * @Author hou
 * @Date 2020/4/20 1:05 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//  构造方法私有</span>
    <span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供一个全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> INSTANCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0c6ftpkqj31c00u0qiu.jpg" alt=""></p> <p>单线程模式下，岁月静好，还是只有一个&quot;孙悟空&quot;。多线程呢？</p> <p>开启多线程测试代码，结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0ccyaok5j31c00u0k7f.jpg" alt=""></p> <p>再运行一遍
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cc92oqhj31c00u07kh.jpg" alt=""></p> <div class="custom-block danger"><p class="custom-block-title">提示</p> <p>懒汉式单例是线程不安全的！！！</p></div> <h4 id="一探究竟"><a href="#一探究竟" class="header-anchor">#</a> 一探究竟</h4> <p>编写测试代码，使用发令枪将主线程阻塞。</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">/**
 * 多线程条件下测试懒汉式单例 - 调试版本
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testConcurrentLazySingleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 线程数</span>
    <span class="token keyword">int</span> threadNum <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">LazySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在判断instance是否为空的代码出添加断点，右键，设置为线程模式
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0ce10eq4j31c00u0aor.jpg" alt=""></p> <p>情况一：<code>多线程使用同一个对象</code><br>
线程一到达判断逻辑
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cfy4pmrj31c00u0tnp.jpg" alt="">
线程一进入方法，并创建instance对象
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cgdc57vj31c00u07i5.jpg" alt="">
线程一输出结果<code>singleton.SunWuKong@e47173e</code> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cgqj0slj31c00u07ig.jpg" alt="">
线程二执行判断逻辑，此时instance不为空，直接返回
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0chbtyyjj31c00u016k.jpg" alt="">
最终执行结果
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0chtpgcgj31c00u07ii.jpg" alt=""></p> <p>情况二：<code>多线程创建了不同对象</code><br>
线程一到达判断逻辑，结果为真，进入方法体
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0ciayq3aj31c00u016d.jpg" alt="">
线程二也到达判断逻辑，结果为真，也进入方法体
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cipz96sj31c00u0qgk.jpg" alt="">
线程二执行创建instance对象，并结束线程
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cjdw71kj31c00u07id.jpg" alt="">
线程一继续执行方法体，创建instance对象，并结束线程
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cjxk57uj31c00u016h.jpg" alt="">
最终结果
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0ck88xvhj31c00u0qh3.jpg" alt=""></p> <p>情况三：<code>线程将先创建的实例覆盖</code><br>
线程一到达判断逻辑，结果为真，进入方法体
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cl4jnqbj31c00u0ann.jpg" alt="">
线程二也到达判断逻辑，结果为真，也进入方法体
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cljq8yqj31c00u0ano.jpg" alt="">
线程一继续执行，创建instance对象
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cm33ouzj31c00u0k55.jpg" alt="">
线程二继续执行，将线程一创建的instance对象覆盖
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cmh6q4nj31c00u0k55.jpg" alt="">
线程二结束线程
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cmtz2qjj31c00u0gzk.jpg" alt="">
线程一结束线程，最终结果
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cn5wqpyj31c00u0anv.jpg" alt=""></p> <div class="custom-block tip"><p>通透！</p></div> <h3 id="懒汉式双重检查单例"><a href="#懒汉式双重检查单例" class="header-anchor">#</a> 懒汉式双重检查单例</h3> <p>既然判断线程问题发生在逻辑判断处，在此处加锁是否可以解决问题呢？<br>
锁加在那里？</p> <h4 id="同步方法"><a href="#同步方法" class="header-anchor">#</a> 同步方法</h4> <p>效率比较低，性能不是太好，不过也可以用，因为是对整个方法加上了线程同步，其实只要在new的时候考虑线程同步就行了，
这种方法不推荐使用</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>lazy_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName LockLazySingleton
 * @Description 同步方法懒汉式单例
 * @Author hou
 * @Date 2020/4/20 1:05 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockMethodLazySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LockMethodLazySingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//  构造方法私有</span>
    <span class="token keyword">private</span> <span class="token class-name">LockMethodLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供一个全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">LockMethodLazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> INSTANCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockMethodLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="锁对象"><a href="#锁对象" class="header-anchor">#</a> 锁对象</h4> <p>synchronized同步块括号中的锁定对象是采用的一个无关的Object类实例，而不是采用this，因为getInstance是一个静态方法，在它内部不能使用未静态的或者未实例的类对象</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>lazy_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName LockObjectLazySingleton
 * @Description 同步代码块懒汉式单例
 * @Author hou
 * @Date 2020/4/20 1:05 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockObjectLazySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LockObjectLazySingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//  构造方法私有</span>
    <span class="token keyword">private</span> <span class="token class-name">LockObjectLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供一个全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LockObjectLazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> INSTANCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockObjectLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="锁类"><a href="#锁类" class="header-anchor">#</a> 锁类</h4> <p>也可以通过锁类的方式实现</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>lazy_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName LockClassLazySingleton
 * @Description 同步代码块懒汉式单例
 * @Author hou
 * @Date 2020/4/20 1:05 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockClassLazySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LockClassLazySingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//  构造方法私有</span>
    <span class="token keyword">private</span> <span class="token class-name">LockClassLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供一个全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LockClassLazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> INSTANCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">LockClassLazySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockClassLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试类测试接口，结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cp2p9l6j31c00u0wun.jpg" alt=""></p> <p>多线程问题再次出现！</p> <p>编写测试类，打断点</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 多线程条件下测试懒汉式单例 - 调试版本
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testLockClassLazySingleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 线程数</span>
    <span class="token keyword">int</span> threadNum <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>threadNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">LockClassLazySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">LockClassLazySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0cqd18lgj31c00u0h0t.jpg" alt=""></p> <h4 id="一探究竟-2"><a href="#一探究竟-2" class="header-anchor">#</a> 一探究竟</h4> <p>（只演示一种情况）</p> <p>线程一判断instance为空，到达同步代码块
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0crvb5ohj31c00u0dv1.jpg" alt="">
线程二判断instance为空，也到达同步代码块
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0csar043j31c00u0180.jpg" alt="">
线程二进入同步代码块，此时，线程一为阻塞状态
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge09zd6awoj31c00u0tn1.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d06hs0oj31c00u0tmu.jpg" alt="">
线程二执行完毕
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d0kw68jj31c00u0wtv.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d0yppfvj31c00u04cn.jpg" alt="">
线程一切换为运行态，继续执行，再一次创建了对象
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d1gf1pqj31c00u0ncj.jpg" alt="">
最终结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d21f7j4j31c00u0wsw.jpg" alt=""></p> <h4 id="双重检查锁"><a href="#双重检查锁" class="header-anchor">#</a> 双重检查锁</h4> <p>因为问题出现在同步代码块内部，将同步代码块中加入一个实例是否为空的校验，进行双重检查</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>lazy_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName DoubleCheckLazySingleton
 * @Description 双重校验锁懒汉式单例
 * @Author hou
 * @Date 2020/4/20 1:05 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DoubleCheckLazySingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DoubleCheckLazySingleton</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//  构造方法私有</span>
    <span class="token keyword">private</span> <span class="token class-name">DoubleCheckLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供一个全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DoubleCheckLazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> INSTANCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">DoubleCheckLazySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> INSTANCE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DoubleCheckLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d2zmkf3j31c00u07k4.jpg" alt=""></p> <p>虽然上面的代码看似完美，仍然存在指令重排序问题，需要在实例对象前加上<code>volatile</code>关键字禁止指令重排序。<br> <a href="https://www.cnblogs.com/lkxsnow/p/12293791.html" target="_blank" rel="noopener noreferrer">单例陷阱——双重检查锁中的指令重排问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="优点-5"><a href="#优点-5" class="header-anchor">#</a> 优点</h4> <p>保证了对象在系统中只有一个实例</p> <h4 id="缺点-5"><a href="#缺点-5" class="header-anchor">#</a> 缺点</h4> <p>同步方法和多重判断导致效率较低</p> <h3 id="静态内部类"><a href="#静态内部类" class="header-anchor">#</a> 静态内部类</h3> <p>外部类加载时并不需要立即加载内部类，内部类不被加载则不去初始化INSTANCE，故而不占内存，而且从jvm层面保证了线程的安全。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>inner_class_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName InnerClassSingleton
 * @Description 内部类式单例
 * @Author hou
 * @Date 2020/4/20 4:05 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InnerClassSingleton</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">InnerClassSingleton</span> SUN_WU_KONG <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InnerClassSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 构造方法私有化</span>
    <span class="token keyword">private</span> <span class="token class-name">InnerClassSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token comment">// 提供全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">InnerClassSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span>SUN_WU_KONG<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，执行结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0d48m8o7j31c00u0ap5.jpg" alt=""></p> <div class="custom-block tip"><p>由于是内部类的原因，单例对象在创建时不支持动态传参，除此，内部类单例几近完美</p></div> <h3 id="枚举式单例"><a href="#枚举式单例" class="header-anchor">#</a> 枚举式单例</h3> <div class="custom-block warning"><p>假设我非要搞破坏呢？</p></div> <p>以最初的饿汉式单例为基础。</p> <h4 id="反射攻击"><a href="#反射攻击" class="header-anchor">#</a> 反射攻击</h4> <p>通过反射获取类的私有构造方法，使用setAccessible启用访问安全检查的开关，通过构造方法创建出新的&quot;单例对象&quot;</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">/**
 * 暴力反射 破坏单例
 * @throws Exception
 */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReflect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取单例对象</span>
    <span class="token class-name">HungrySingleton</span> instance <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 通过反射 暴力创建一个对象</span>
    <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HungrySingleton</span><span class="token punctuation">&gt;</span></span> constructor <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    constructor<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HungrySingleton</span> hungrySingleton <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hungrySingleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>解决方案：在构造方法里边添加判断逻辑，如果已经实例化过的对象，再次调用构造方法，抛出异常</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>hungry_singleton</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName HungrySingleton
 * @Description 饿汉式单例
 * @Author hou
 * @Date 2020/4/20 12:49 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HungrySingleton2</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton2</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 构造方法私有化</span>
    <span class="token keyword">private</span> <span class="token class-name">HungrySingleton2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> INSTANCE<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;单例对象已经存在，不允许再次调用构造方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton2</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0j7hyvozj31c00u0dw2.jpg" alt=""></p> <h4 id="序列化攻击"><a href="#序列化攻击" class="header-anchor">#</a> 序列化攻击</h4> <div class="custom-block warning"><p>假设我还要搞破坏呢？</p></div> <p>复制一个饿汉式单例，并实现序列化接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">singleton<span class="token punctuation">.</span>hungry_singleton</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName HungrySingleton3
 * @Description 饿汉式单例
 * @Author hou
 * @Date 2020/4/20 12:49 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HungrySingleton3</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton3</span> INSTANCE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingleton3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 构造方法私有化</span>
    <span class="token keyword">private</span> <span class="token class-name">HungrySingleton3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 提供全局访问点</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HungrySingleton3</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>通过序列化后反序列化生成新的对象，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0jkui96vj31c00u0toa.jpg" alt=""></p> <p>解决方案：</p> <ol><li>不实现序列化接口</li> <li>在单例类中添加<code>readResolve()</code>方法，反序列化时，如果定义了readResolve()则直接返回此方法指定的对象。而不需要单独再创建新对象</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Object</span> <span class="token function">readResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> INSTANCE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再次执行测试代码，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0k6nck9cj31c00u0dvl.jpg" alt=""></p> <p>相关代码
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0k9iw5uwj31c00u04dy.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0k9w2m9xj31c00u04hk.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0kakfer1j31c00u04gl.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0kc327gdj31c00u0wwj.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0kcjxx26j31c00u0ask.jpg" alt=""></p> <h2 id="原型模式"><a href="#原型模式" class="header-anchor">#</a> 原型模式 <span class="badge tip" style="vertical-align:top;" data-v-01e68abf>创建型</span></h2> <p>原型模式（Prototype）：用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p> <h3 id="示例-3"><a href="#示例-3" class="header-anchor">#</a> 示例</h3> <div class="custom-block tip"><p>《西游记》中孙悟空可以&quot;拔一根毫毛，吹出猴万个&quot;，原型模式就以此举例</p></div> <p>定义一个接口。包含一个<code>clone</code>方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">prototype</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @InterfaceName IPrototype
 * @Description 原型模式接口
 * @Author hou
 * @Date 2020/4/21 10:16 下午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IPrototype</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
     <span class="token class-name">T</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>新建<code>金箍棒</code>类</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">prototype</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Weapon
 * @Description 武器
 * @Author hou
 * @Date 2020/4/21 5:25 下午
 * @Version 1.0
 **/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Weapon</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;如意金箍棒，一万三千五百斤&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>新建<code>孙悟空</code>类，有一个武器<code>金箍棒</code>，实现<code>IPrototype</code>接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">prototype</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName SunWuKong
 * @Description 孙悟空
 * @Author hou
 * @Date 2020/4/21 5:24 下午
 * @Version 1.0
 **/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SunWuKong</span> <span class="token keyword">implements</span> <span class="token class-name">IPrototype</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SunWuKong</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;石猴&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> gender <span class="token operator">=</span> <span class="token string">&quot;公&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Weapon</span> jinGuBang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Weapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SunWuKong</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SunWuKong</span> sunWuKong <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SunWuKong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sunWuKong<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sunWuKong<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sunWuKong<span class="token punctuation">.</span><span class="token function">setJinGuBang</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>jinGuBang<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> sunWuKong<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge1r45st59j31c00u0k7j.jpg" alt=""></p> <p>从结果可见，除了复制的本体不一样，里边包含的属性均相同，包括<code>金箍棒</code>，可是复制出来的&quot;猴子&quot;不应该拥有相同的金箍棒
这种情况被称为<code>浅克隆</code></p> <h4 id="浅克隆"><a href="#浅克隆" class="header-anchor">#</a> 浅克隆</h4> <p>浅克隆，用来创建一个新的对象，然后将当前对象的非静态字段复制到新对象，如果该字段是值类型的，则对该字段执行逐位复制，如果该字段是引用类型的，则复制引用但不复制引用的对象。</p> <p>所有类的父类<code>Object</code>中也包含了一个<code>浅克隆</code>的实现</p> <p>编写代码</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">prototype</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName SunWuKong
 * @Description 孙悟空
 * @Author hou
 * @Date 2020/4/21 5:24 下午
 * @Version 1.0
 **/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SunWuKong2</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;石猴&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> gender <span class="token operator">=</span> <span class="token string">&quot;公&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Weapon</span> jinGuBang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Weapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SunWuKong2</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">SunWuKong2</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge1rk97f3uj31c00u0wv2.jpg" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>Cloneable接口中并没有实质性的方法，仅仅是一个标记作用；如果直接重写了clone方法，但是没有实现接口的话会抛出<code>CloneNotSupportedException</code>异常。<br> <code>clone</code>方法在<code>Object</code>中是<code>protected</code>的，可以在子类中进行扩大可见范围。</p></div> <h3 id="深克隆"><a href="#深克隆" class="header-anchor">#</a> 深克隆</h3> <p>要想让每一个分身都有一根&quot;金箍棒&quot;就要用到深克隆<br>
深克隆：用来创建一个新的对象，都含有与原来对象相同的值，除了那些引用其他对象的变量。那些引用其他对象的变量将指向一个被复制的新对象，而不再是原有那些被引用对象。即深克隆把要复制的对象所引用的对象也都复制了一次，而这种对被引用到的对象克隆叫做间接克隆。</p> <p>重新定义一个<code>孙悟空</code>类，通过序列化反序列化克隆一个新的<code>孙悟空</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">prototype</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName SunWuKong
 * @Description 孙悟空
 * @Author hou
 * @Date 2020/4/21 5:24 下午
 * @Version 1.0
 **/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SunWuKong3</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token string">&quot;石猴&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> gender <span class="token operator">=</span> <span class="token string">&quot;公&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Weapon</span> jinGuBang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Weapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">SunWuKong3</span> <span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CloneNotSupportedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">SunWuKong3</span><span class="token punctuation">)</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">SunWuKong3</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 写出</span>
        <span class="token class-name">ByteArrayOutputStream</span> bos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 读入</span>
        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>bos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">SunWuKong3</span><span class="token punctuation">)</span>ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>测试结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge1s7s11cjj31c00u018y.jpg" alt=""></p> <div class="custom-block tip"><p>此时的武器应该实现序列化接口</p></div> <h4 id="优点-6"><a href="#优点-6" class="header-anchor">#</a> 优点</h4> <p>可以方便的创建一个对象</p> <h4 id="缺点-6"><a href="#缺点-6" class="header-anchor">#</a> 缺点</h4> <p>使用深克隆浅克隆需要考虑性能的问题，在大量的深克隆中效率不高</p> <h2 id="代理模式"><a href="#代理模式" class="header-anchor">#</a> 代理模式</h2> <h3 id="定义"><a href="#定义" class="header-anchor">#</a> 定义</h3> <h3 id="静态代理"><a href="#静态代理" class="header-anchor">#</a> 静态代理</h3> <h3 id="动态代理"><a href="#动态代理" class="header-anchor">#</a> 动态代理</h3> <h3 id="jdk"><a href="#jdk" class="header-anchor">#</a> jdk</h3> <h3 id="cglib"><a href="#cglib" class="header-anchor">#</a> cglib</h3> <h2 id="策略模式"><a href="#策略模式" class="header-anchor">#</a> 策略模式</h2> <h2 id="模板模式"><a href="#模板模式" class="header-anchor">#</a> 模板模式</h2> <h2 id="适配器模式"><a href="#适配器模式" class="header-anchor">#</a> 适配器模式</h2> <h2 id="装饰者模式"><a href="#装饰者模式" class="header-anchor">#</a> 装饰者模式</h2> <h2 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h2> <p>观察者模式又叫发布-订阅模式（Publish/Subsctibe），定义了一种一对多的依赖关系，让多个观察者对象同时监听某一个主题对象。这个主题对象在状态发生变化时，会通知所有观察者对象，使它们能够自己更新自己。</p> <h2 id="享元模式"><a href="#享元模式" class="header-anchor">#</a> 享元模式 <span class="badge tip" style="vertical-align:top;" data-v-01e68abf>结构型</span></h2> <p>享元模式（Flyweight Pattern）：运用共享技术有效地支持大量细粒度的对象。用于减少创建对象的数量，以减少内存占用和提高性能。
在软件开发过程中，如果有使用大量相同的对象，只要共享一个就可以，这就是享元模式，减少了不必要的内存消耗。</p> <p>享元模式由以下部分组成:</p> <p>抽象享元类（Flyweight）: 所有具体享元类的超类或者接口，通过这个接口，Flyweight可以接受并作用于外部。<br>
具体享元类（ConcreteFlyweight）：指定内部状态，为内部状态增加存储空间。<br>
享元工厂类（FlyweightFactory）：用来创建并管理Flyweight对象，它主要用来确保合理地共享Flyweight，当用户请求一个Flyweight时，FlyweightFactory就会提供一个已经创建的Flyweight对象或者新建一个（如果不存在）。</p> <h3 id="示例-4"><a href="#示例-4" class="header-anchor">#</a> 示例</h3> <div class="custom-block tip"><p>唐僧西天取经期间收徒<code>孙悟空</code> <code>猪悟能</code> <code>沙悟净</code> <code>白龙马</code>，取经过程中<code>孙悟空</code>总是被唐僧驱逐，模拟此过程</p></div> <p>定义<code>徒弟接口</code>（抽象享元接口）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">flyweight</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @InterfaceName IApprentice
 * @Description 徒弟接口
 * @Author hou
 * @Date 2020/4/22 12:13 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IApprentice</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

</code></pre></div><p>定义三个徒弟类(具体享元类)<code>孙悟空</code> <code>猪悟能</code> <code>沙悟净</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">flyweight</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName SuWukong
 * @Description 孙悟空
 * @Author hou
 * @Date 2020/4/22 12:10 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SunWuKong</span> <span class="token keyword">implements</span> <span class="token class-name">IApprentice</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;神通广大的孙悟空&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">flyweight</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName ZhuBaJie
 * @Description 猪八戒
 * @Author hou
 * @Date 2020/4/22 12:10 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZhuBaJie</span> <span class="token keyword">implements</span> <span class="token class-name">IApprentice</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;好吃懒做的猪悟能&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">flyweight</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName ShaWuJing
 * @Description 沙悟净
 * @Author hou
 * @Date 2020/4/22 12:10 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShaWuJing</span> <span class="token keyword">implements</span> <span class="token class-name">IApprentice</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;憨厚老实的沙悟净&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>创建一个徒弟工厂（简单工厂）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">flyweight</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName ApprenticeFactory
 * @Description TODO
 * @Author hou
 * @Date 2020/4/22 12:25 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApprenticeFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">IApprentice</span> <span class="token function">apprentice</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;孙悟空&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SunWuKong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;猪悟能&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ZhuBaJie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;沙悟净&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ShaWuJing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义西游记类（享元工厂类）</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">flyweight</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @ClassName Journey2TheWest
 * @Description TODO
 * @Author hou
 * @Date 2020/4/22 12:22 上午
 * @Version 1.0
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Journey2TheWest</span> <span class="token punctuation">{</span>

    <span class="token comment">// 保存对象</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">IApprentice</span><span class="token punctuation">&gt;</span></span> cacheFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 如果缓存没有对象，此处就存起来；如果缓存有对象，此处就不进行处理</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">apprentice</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
        cacheFactory<span class="token punctuation">.</span><span class="token function">putIfAbsent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token class-name">ApprenticeFactory</span><span class="token punctuation">.</span><span class="token function">apprentice</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        cacheFactory<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;name: %s, desc: %s&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编写测试代码，结果如下：
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge1v2wepp8j31c00u0k89.jpg" alt=""></p> <h3 id="优点-7"><a href="#优点-7" class="header-anchor">#</a> 优点</h3> <p>享元模式的优点在于它能够极大的减少系统中对象的个数。<br>
享元模式由于使用了外部状态，外部状态相对独立，不会影响到内部状态，所以享元模式使得享元对象能够在不同的环境被共享。</p> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <p><a href="https://www.jianshu.com/p/70f7fd47f2e2" target="_blank" rel="noopener noreferrer">关于三种工厂模式的总结<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://www.cnblogs.com/qq895139140/p/7774152.html" target="_blank" rel="noopener noreferrer">单例模式（Singleton）的同步锁synchronized<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><br> <a href="https://blog.csdn.net/u012482647/article/details/78562486" target="_blank" rel="noopener noreferrer">设计模式（Design Pattern）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">最后更新时间: </span> <span class="time">2021/10/20 上午3:16:00</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.6f47cd4a.js" defer></script><script src="/assets/js/5.0858778f.js" defer></script><script src="/assets/js/1.474579b7.js" defer></script><script src="/assets/js/18.f18c6ce8.js" defer></script><script src="/assets/js/11.a67626a0.js" defer></script>
  </body>
</html>
